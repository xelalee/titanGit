<html>
  <head>
    <title>TitanWALL web report</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
<!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
<![endif]-->
<!-- css -->
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/console.css" />
    <link rel="stylesheet" type="text/css" href="css/cssbutton-min.css" />
    <link rel="stylesheet" type="text/css" href="css/datatable-base.css" />
    <link rel="stylesheet" type="text/css" href="css/datatable-sort.css" />
    <link rel="stylesheet" type="text/css" href="css/panel.css" />
    <link rel="stylesheet" type="text/css" href="css/portal.css" />
    <link rel="stylesheet" type="text/css" href="css/screen.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-base.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-stack.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-modality.css" />
<!-- yui -->
    <script type="text/javascript" src="js/yui-min.js"></script>
    <script type="text/javascript" src="js/yuiCombo1.js"></script>
    <script type="text/javascript" src="js/yuiCombo2.js"></script>
    <script type="text/javascript" src="js/yuiCombo3.js"></script>
    <script type="text/javascript" src="js/yuiCombo4.js"></script>
    <script type="text/javascript" src="js/yuiCombo5.js"></script>
    <script type="text/javascript" src="js/yuiCombo6.js"></script>
    <script type="text/javascript" src="js/yuiCombo7.js"></script>
    <script type="text/javascript" src="js/yuiCombo8.js"></script>
    <script type="text/javascript" src="js/yuiCombo9.js"></script>
    <script type="text/javascript" src="js/widget-base-ie.js"></script>
<!-- jquery -->
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.9.2.custom.css" />
    <script type="text/javascript" src="js/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="js/jquery.bgiframe.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.js"></script>
<!-- jspdf -->
    <script type="text/javascript" src="assets/jspdf/jspdf.js"></script>
<!-- custom -->
    <link rel="stylesheet" type="text/css" href="css/reporter.css" />

    <script>

$.extend({
  getUrlVars: function(){
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  },
  getUrlVar: function(name){
    return $.getUrlVars()[name];
  }
});

$(document).ready(function () {
    // define vars
    var lang = 'en';
    var gData = {};
    var gReady = {};
    var gObj = {
        "traffic_direction" : {
            "title" : {
                "en" : "Traffic Direction"
            },
            "tabs" : {
                "en" : {
                    "0": "Traffic Log",
                    "1": "By Address",
                    "2": "By Source IP",
                    "3": "By Destination IP",
                    "4": "By Protocol",
                    "5": "By Destination Port",
                    "6": "By Zone"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "srcIp" : "Source Address",
                        "dstIp" : "Destination Address",
                        "protocol" : "Protocol",
                        "srcPort" : "Source Port",
                        "dstPort" : "Destination Port",
                        "fromZone" : "From Zone",
                        "toZone" : "To Zone",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "startDatetime" : "Start Datetime",
                        "endDatetime" : "End Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "srcIp" : "Source Address",
                        "dstIp" : "Destination Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "2" : {
                        "id" : "ID",
                        "srcIp" : "Source Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "3" : {
                        "id" : "ID",
                        "dstIp" : "Destination Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "4" : {
                        "id" : "ID",
                        "protocol" : "Protocol",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "5" : {
                        "id" : "ID",
                        "dstPort" : "Destination Port",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "6" : {
                        "id" : "ID",
                        "fromZone" : "From Zone",
                        "toZone" : "To Zone",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    }
                }
            }
        },
        "file_extension" : {
            "title" : {
                "en" : "File Extension"
            },
            "tabs" : {
                "en" : {
                    "0": "File Extension Log",
                    "1": "By File Extension"
                 }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "extension" : "Extension",
                        "accessCount" : "Access Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "extension" : "Extension",
                        "accessCount" : "Access Count"
                    }
                }
            }
        },
        "blocked_host" : {
            "title" : {
                "en" : "Bloceck Host"
            },
            "tabs" : {
                "en" : {
                    "0": "Blocked Host Log",
                    "1": "By Blocked Host"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusCount" : "Virus Count",
                        "firewallCount" : "Firewall Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusCount" : "Virus Count",
                        "firewallCount" : "Firewall Count"
                    }
                }
            }
        },
        "affected_host" : {
            "title" : {
                "en" : "Affected Host"
            },
            "tabs" : {
                "en" : {
                    "0": "Affected Host Log",
                    "1": "By Affected Host"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusHitCount" : "Virus Hit Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusHitCount" : "Virus Hit Count"
                    }
                }
            }
        },
        "antivirus_report" : {
            "title" : {
                "en" : "Antivirus Report"
            },
            "tabs" : {
                "en" : {
                    "0": "Antivirus Log",
                    "1": "By Source IP",
                    "2": "By Destination IP",
                    "3": "By Virus Name"

                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "srcIp" : "Source IP",
                        "dstIp" : "Destination IP",
                        "protocol" : "Protocol",
                        "virusName" : "Virus Name",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "srcIp" : "Source IP",
                        "hitCount" : "Hit Count"
                    },
                    "2" : {
                        "id" : "ID",
                        "dstIp" : "Destination IP",
                        "hitCount" : "Hit Count"
                    },
                    "3" : {
                        "id" : "ID",
                        "virusName" : "Virus Name",
                        "hitCount" : "Hit Count"
                    }
                }
            }
        }
    }

    function getData( param, sd, sh, ed, eh, q ) {
        $.ajax({
            url: 'advancedQuery.php?param=' + param + '&sd=' + sd + '&sh=' + sh + '&ed=' + ed + '&eh=' + eh + '&q=' + q,
            dataType: 'json',
            success: function(data) {
console.log( q + ' data got ');
                gReady[ q ] = true;
                gData[ q ] = data;
                // draw frame here

                if ( 0 == q ) {
                    // table with rows
                    $('#panel-' + q).html('<div id="div-table-' + q + '"><table id="table-' + q + '"><thead></thead><tbody></tbody></table></div>');
                } else {
                    // chart 
                    $('#panel-' + q).html('<div id="div-chart-' + q + '"></div>');
                    
                    // table 
                    $('#panel-' + q).append('<div id="div-table-' + q + '"><table id="table-' + q + '"><thead></thead><tbody></tbody></table></div>');
                }

                setData( param, sd, sh, ed, eh, q, data );
            }
        });
    }

    function setData( param, sd, sh, ed, eh, q, data ) {
        // draw table
        $('#table-' + q + ' thead').html('<tr></tr>');
        for ( var x in gObj[ param ][ 'table' ][ lang ][ q ] )
            $('#table-' + q + ' thead tr').append( '<th class="ui-state-default">' + gObj[ param ][ 'table' ][ lang ][ q ][ x ] + '</th>' );

        if ( data.queryRows > 0 ) {
            for (var i=0, len=data.queryResults.length; i<len; i++)
            {
                var tmp = '<tr class="' + ((i%2==0)? 'odd' : 'even') + '">';
                for ( var x in gObj[ param ][ 'table' ][ lang ][ q ] )
                {
                    if ('id' == x)
                        tmp += '<td>' + (i+1)  + '</td>';
                    else 
                        tmp += '<td>' + data.queryResults[ i ][ x ] + '</td>';
                }
                tmp += '</tr>';
                $('#table-' + q + ' tbody').append( tmp );
            }
        }

        if ( 0 != q ) {
            // draw chart
        
        }
    }

    function genWeekly() {

    }

    function genHd( content ) {
        $('#bd_hd').html( '<p>' + content + '</p>' );
    }

    function genBd( param, sd, sh, ed, eh, q ) {
        $('#bd_bd').append('<div id="bd_bd_' + param + '" class="tabber"><ul></ul></div>');

        for ( var x in gObj[ param ][ 'tabs' ][ lang ] )
        {
            $('.tabber ul').append('<li id="tab-' + x + '"><a href="#panel-' + x + '">' + gObj[ param ][ 'tabs' ][ lang ][ x ] + '</a></li>');
            $('.tabber').append('<div id="panel-' + x + '"></div>');
            // data ready falg
            gReady[ x ] = false;
        }

        $('.tabber').tabs({
            active: q,
            create: function( event, ui ) {
                if ( 0 == q ) {
                    $('.pdfer').hide();
                    $('.pager').show();
                } else {
                    $('.pdfer').show();
                    $('.pager').hide();
                }
            },
            select: function( event, ui ) {
                if ( 0 === parseInt( ui.index ) ) {
                    $('.pdfer').hide();
                    $('.pager').show();
                } else {
                    $('.pdfer').show();
                    $('.pager').hide();
                }
            }
        });

        // data
        getData( param, sd, sh, ed, eh, q );
    }

    function genFt( param ) {
        var tmp = '<div id="pagerDiv">';
        tmp += '<table id="pagerTable-' + param + '" class="BorderNone">';
        tmp += '<tr>';
        tmp += '<td class="pager"><button Class="Move2First" id="Move2First-' + param + '"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><button Class="Move2Prev" id="Move2Prev-' + param + '"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><span id="rowsPage">1</span> / <span id="rowsPages">1</span></td>';
        tmp += '<td class="pager"><button Class="Move2Next" id="Move2Next-' + param + '"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><button Class="Move2Last" id="Move2Last-' + param + '"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><select id="phpPerPage"><option value="20">20</option><option value="50">50</option><option value="100">100</option></select>';
   
        tmp += '<td class="pdfer"><button Class="ExportPDF" id="ExportPDF-' + param + '"><span class="ui-icon"></span></button></td>';
        tmp += '</tr>';
        tmp += '</table>';
        tmp += '</div>';

        $('#bd_ft').html( tmp );
    }

    function genFooter() {
        $('#ft').html('<p>Copyright &copy; 2014 TECH TITAN</p>');
    }

    function init() {

        if ( 'weekly' == $.getUrlVar( 'param' ) ) {
            genWeekly();
        } else {
            genHd( gObj[ $.getUrlVar( 'param' ) ][ 'title' ][ lang ] );
            genFt( $.getUrlVar( 'param' ) );
            genBd( $.getUrlVar( 'param' ), $.getUrlVar( 'sd' ), $.getUrlVar( 'sh' ), $.getUrlVar( 'ed' ), $.getUrlVar( 'eh' ), $.getUrlVar( 'q' ) );
        }
        genFooter();
    }

    init();

});

    </script>
  </head>
  <body>
    <div id="layout">
      <div id="hd"></div>
      <div id="bd">
        <div id="bd_hd"></div>
        <div id="bd_bd"></div>
        <div id="bd_ft"></div>
      </div>
      <div id="ft"></div>
    </div>
  </body>
</html>
