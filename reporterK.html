<html>
  <head>
    <title>TitanWALL web report</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
<!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
<![endif]-->
<!-- css -->
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/console.css" />
    <link rel="stylesheet" type="text/css" href="css/cssbutton-min.css" />
    <link rel="stylesheet" type="text/css" href="css/datatable-base.css" />
    <link rel="stylesheet" type="text/css" href="css/datatable-sort.css" />
    <link rel="stylesheet" type="text/css" href="css/panel.css" />
    <link rel="stylesheet" type="text/css" href="css/portal.css" />
    <link rel="stylesheet" type="text/css" href="css/screen.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-base.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-stack.css" />
    <link rel="stylesheet" type="text/css" href="css/widget-modality.css" />
<!-- yui -->
    <script type="text/javascript" src="js/yui-min.js"></script>
    <script type="text/javascript" src="js/yuiCombo1.js"></script>
    <script type="text/javascript" src="js/yuiCombo2.js"></script>
    <script type="text/javascript" src="js/yuiCombo3.js"></script>
    <script type="text/javascript" src="js/yuiCombo4.js"></script>
    <script type="text/javascript" src="js/yuiCombo5.js"></script>
    <script type="text/javascript" src="js/yuiCombo6.js"></script>
    <script type="text/javascript" src="js/yuiCombo7.js"></script>
    <script type="text/javascript" src="js/yuiCombo8.js"></script>
    <script type="text/javascript" src="js/yuiCombo9.js"></script>
    <script type="text/javascript" src="js/widget-base-ie.js"></script>
<!-- jquery -->
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.9.2.custom.css" />
    <script type="text/javascript" src="js/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="js/jquery.bgiframe.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.js"></script>
<!-- chart js -->
    <script type="text/javascript" src="js/Chart.js"></script>
<!-- jspdf -->
    <script type="text/javascript" src="assets/jspdf/jspdf.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.addimage.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.cell.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.from_html.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.ie_below_9_shim.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.javascript.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.sillysvgrenderer.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.split_text_to_size.js"></script>
    <script type="text/javascript" src="assets/jspdf/jspdf.plugin.standard_fonts_metrics.js"></script>
    <script type="text/javascript" src="assets/jspdf/adler32cs.js"></script>
    <script type="text/javascript" src="assets/jspdf/FileSaver.js"></script>
    <script type="text/javascript" src="assets/jspdf/BlobBuilder.js"></script>
    <script type="text/javascript" src="assets/jspdf/basic.js"></script>
<!-- custom -->
    <link rel="stylesheet" type="text/css" href="css/reporterK.css" />

    <script>

$.extend({
  getUrlVars: function(){
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  },
  getUrlVar: function(name){
    return $.getUrlVars()[name];
  }
});

$(document).ready(function () {
    // define func
    jQuery.fn.exists = function() {
        return this.length > 0;
    }

    // yui instance
    var gY = YUI({filter:"raw", defaultGraphicEngine: "canvas"}).use('anim', 'charts', 'charts-legend', 'console', 'cookie', 'datasource', 'datasource-get', 'datasource-io', 'datasource-jsonschema', 'datatable-base', 'datatable-sort', 'datatable-datasource', 'dd', 'dd-plugin', 'dump', 'event', 'get', 'io-base', 'io-upload-iframe', 'json', 'json-parse', 'json-stringify', 'node', 'panel', 'uploader', 'yui');

    // define vars
    var lang   = 'en';
    var gData  = {};
    var gQue   = {};
    var gTabs  = [];
    var gProto = {};
    var gChart = {};
    var gCache = {};
    var gColor = [ "red", "blue", "black", "green", "yellow", "purple", "pink", "orange", "brown"];

    var gObj = {
        "traffic_direction" : {
            "title" : {
                "en" : "Traffic Direction"
            },
            "tabs" : {
                "en" : {
                    "0": "Traffic Log",
                    "1": "By Address",
                    "2": "By Source IP",
                    "3": "By Destination IP",
                    "4": "By Protocol",
                    "5": "By Destination Port",
                    "6": "By Zone"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "srcIp" : "Source Address",
                        "dstIp" : "Destination Address",
                        "protocol" : "Protocol",
                        "srcPort" : "Source Port",
                        "dstPort" : "Destination Port",
                        "fromZone" : "From Zone",
                        "toZone" : "To Zone",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "startDatetime" : "Start Datetime",
                        "endDatetime" : "End Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "address" : "Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "2" : {
                        "id" : "ID",
                        "srcIp" : "Source Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "3" : {
                        "id" : "ID",
                        "dstIp" : "Destination Address",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "4" : {
                        "id" : "ID",
                        "protocol" : "Protocol",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "5" : {
                        "id" : "ID",
                        "dstPort" : "Destination Port",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    },
                    "6" : {
                        "id" : "ID",
                        "zone" : "Zone",
                        "txBytes" : "Tx Bytes",
                        "rxBytes" : "Rx Bytes",
                        "totalBytes" : "Total Bytes",
                        "sessions" : "Sessions"
                    }
                }
            },
            "chart" : {
                "en" : {
                    "1" : {
                        type : 'bar',
                        catKey : 'address',
                        styleDef : {
                            axes : {
                                address : {
                                    keys:["address"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    },
                    "2" : {
                        type : 'bar',
                        catKey : 'srcIp',
                        styleDef : {
                            axes : {
                                srcIp : {
                                    keys:["srcIp"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    },
                    "3" : {
                        type : 'bar',
                        catKey : 'dstIp',
                        styleDef : {
                            axes : {
                                dstIp : {
                                    keys:["dstIp"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    },
                    "4" : {
                        type : "pie",
                        catKey : 'protocol',
                        styleDef : {
                            axes : {
                                protocol : {
                                    keys:["protocol"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    },
                    "5" : {
                        type : "bar",
                        catKey : 'dstPort',
                        styleDef : {
                            axes : {
                                dstPort : {
                                    keys:["dstPort"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    },
                    "6" : {
                        type : "bar",
                        catKey : 'zone',
                        styleDef : {
                            axes : {
                                zone : {
                                    keys:["zone"],
                                    position:"left"
                                },
                                totalBytes : {
                                    keys:["totalBytes"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                txBytes: {
                                    line: { color: "#eeeeee" }
                                },
                                rxBytes : {
                                    line: { color: "#ffffff" }
                                }
                            }
                        }
                    }
                }
            }
        },
        "file_extension" : {
            "title" : {
                "en" : "File Extension"
            },
            "tabs" : {
                "en" : {
                    "0": "File Extension Log",
                    "1": "By File Extension"
                 }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "extension" : "Extension",
                        "accessCount" : "Access Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "extension" : "Extension",
                        "accessCount" : "Access Count"
                    }
                }
            },
            "chart" : {
                "en" : {
                    "1" : {
                        type : "bar",
                        catKey : 'extension',
                        styleDef : {
                            axes : {
                                extension : {
                                    keys:["extension"],
                                    position:"left"
                                },
                                accessCount : {
                                    keys:["accessCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                accessCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    }
                }
            }
        },
        "blocked_host" : {
            "title" : {
                "en" : "Bloceck Host"
            },
            "tabs" : {
                "en" : {
                    "0": "Blocked Host Log",
                    "1": "By Blocked Host"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusCount" : "Virus Count",
                        "firewallCount" : "Firewall Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusCount" : "Virus Count",
                        "firewallCount" : "Firewall Count"
                    }
                }
            },
            "chart" : {
                "en" : {
                    "1" : {
                        type : "bar",
                        catKey : 'ip',
                        styleDef : {
                            axes : {
                                ip : {
                                    keys:["ip"],
                                    position:"left"
                                },
                                firewallCount : {
                                    keys:["firewallCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                firewallCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    }
                }
            }
        },
        "affected_host" : {
            "title" : {
                "en" : "Affected Host"
            },
            "tabs" : {
                "en" : {
                    "0": "Affected Host Log",
                    "1": "By Affected Host"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusHitCount" : "Virus Hit Count",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "ip" : "IP",
                        "virusHitCount" : "Virus Hit Count"
                    }
                }
            },
            "chart" : {
                "en" : {
                    "1" : {
                        type : "bar",
                        catKey : 'ip',
                        styleDef : {
                            axes : {
                                ip : {
                                    keys:["ip"],
                                    position:"left"
                                },
                                sigHitCount : {
                                    keys:["sigHitCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                sigHitCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    }
                }
            }
        },
        "antivirus_report" : {
            "title" : {
                "en" : "Antivirus Report"
            },
            "tabs" : {
                "en" : {
                    "0": "Antivirus Log",
                    "1": "By Source IP",
                    "2": "By Destination IP",
                    "3": "By Virus Name"
                }
            },
            "table" : {
                "en" : {
                    "0" : {
                        "id" : "ID",
                        "srcIp" : "Source IP",
                        "dstIp" : "Destination IP",
                        "protocol" : "Protocol",
                        "virusName" : "Virus Name",
                        "datetime" : "Datetime"
                    },
                    "1" : {
                        "id" : "ID",
                        "srcIp" : "Source IP",
                        "hitCount" : "Hit Count"
                    },
                    "2" : {
                        "id" : "ID",
                        "dstIp" : "Destination IP",
                        "hitCount" : "Hit Count"
                    },
                    "3" : {
                        "id" : "ID",
                        "virusName" : "Virus Name",
                        "hitCount" : "Hit Count"
                    }
                }
            },
            "chart" : {
                "en" : {
                    "1" : {
                        type : "bar",
                        catKey : 'srcIp',
                        styleDef : {
                            axes : {
                                srcIp : {
                                    keys:["srcIp"],
                                    position:"left"
                                },
                                hitCount : {
                                    keys:["hitCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                hitCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    },
                    "2" : {
                        type : "bar",
                        catKey : 'dstIp',
                        styleDef : {
                            axes : {
                                dstIp : {
                                    keys:["dstIp"],
                                    position:"left"
                                },
                                hitCount : {
                                    keys:["hitCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                hitCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    },
                    "3" : {
                        type : "bar",
                        catKey : 'virusName',
                        styleDef : {
                            axes : {
                                virusName : {
                                    keys:["virusName"],
                                    position:"left"
                                },
                                hitCount : {
                                    keys:["hitCount"],
                                    position:"bottom",
                                    type:"numeric"
                                }
                            },
                            series:  {
                                hitCount: {
                                    line: { color: "#eeeeee" }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    $(document).on('click', 'button', function(e) {
        e.preventDefault();
        switch( $(this).attr('id') )
        {
        case 'Move2First':
            if (gCache.pi > 1) {
                gCache.pi = 1;
                resetData();
            }
            break;
        case 'Move2Prev':
            if (gCache.pi > 1) {
                gCache.pi--;
                resetData();
            }
            break;
        case 'Move2Next':
            if (gCache.pi < parseInt( $('#rowsPages').html() )) {
                gCache.pi++;
                resetData();
            }
            break;
        case 'Move2Last':
            if ( gCache.pi < parseInt( $('#rowsPages').html() ) ) {
                gCache.pi = parseInt( $('#rowsPages').html() );
                resetData();
            }
            break;
        case 'ExportPDF':


            break;
        }
    });

    $(document).on('change', 'select', function(e) {
        e.preventDefault();
        if ( 0 === gCache.tabIndex ) {
            gCache.pp = parseInt( $('#rows').val() );
            resetData();
        } else {
            setData( gCache.param, gCache.tabIndex, gCache.tabIndex, gData[ gCache.tabIndex ].queryResults.slice( 0, $('#tops').val() ) );
        }
    });

    function getData( param, sd, sh, ed, eh, idx, q ) {
        $.ajax({
            url: 'advancedQuery.php?param=' + param + '&sd=' + sd + '&sh=' + sh + '&ed=' + ed + '&eh=' + eh + '&q=' + idx,
            dataType: 'json',
            success: function(data) {
                loadingToggle( false );
                // transfer protocol from int to string,,,

                for (var i=0, len=data.queryResults.length; i<len; i++)
                    data.queryResults[ i ].protocol = gProto[ data.queryResults[ i ].protocol ];

                gData[ idx ] = data;
                // enable tab
                $('.tabber').tabs( "enable", idx );

                // draw frame here
                var results;
                if ( 0 == idx ) {
                    // table with rows
                    $('#panel-' + idx).html('<div id="div-table-' + idx + '"><table id="table-' + idx + '"><thead></thead><tbody></tbody></table></div>');
                    // limit 20
                    results = data.queryResults;
                    // update rows
                    $('#rowsPages').html( Math.ceil( data.queryRows/20 ) );
                } else {
                    // chart
                    $('#panel-' + idx).html('<div id="div-chart-' + idx + '"><div id="chart-' + idx + '"></div></div>');

                    // table
                    $('#panel-' + idx).append('<div id="div-table-' + idx + '"><table id="table-' + idx + '"><thead></thead><tbody></tbody></table></div>');

                    // limit 10
                    results = data.queryResults.slice(0,10);
                }

                setData( param, idx, q, results );

                // remove que
                delete gQue[ idx ];

                // get next que
                for (var x in gQue)
                {
                    if ( gQue[ x ] ) {
                        getData( param, sd, sh, ed, eh, x, q );
                        break;
                    }
                }
            }
        });
    }

    function setData( param, idx, q, data ) {
        // draw table
        $('#table-' + idx + ' thead').html('<tr></tr>');
        for ( var x in gObj[ param ][ 'table' ][ lang ][ idx ] )
            $('#table-' + idx + ' thead tr').append( '<th class="ui-state-default">' + gObj[ param ][ 'table' ][ lang ][ idx ][ x ] + '</th>' );

        $('#table-' + idx + ' tbody').empty();
        if ( data.length > 0 ) {
            for (var i=0, len=data.length; i<len; i++)
            {
                var tmp = '<tr class="' + ( ( i%2==0 )? 'odd' : 'even' ) + '">';
                for ( var x in gObj[ param ][ 'table' ][ lang ][ idx ] )
                {
                    tmp += '<td>';
                    switch( x )
                    {
                    case 'id':
                        tmp += (i+1);
                        break;
                    case 'txBytes':
                    case 'rxBytes':
                    case 'totalBytes':
                        var mkbs = parseInt( data[ i ][ x ] );
                        tmp += ( ( mkbs > 1000000000 )? (mkbs/1000000000).toFixed(2) + ' GB' : ( ( mkbs > 1000000 )? (mkbs/1000000).toFixed(2) + ' MB' : ( ( 0 == mkbs )? 0 : (mkbs/1000).toFixed(2) + ' KB' ) ) );
                        break;
                    default:
                        tmp += data[ i ][ x ];
                    }
                    tmp += '</td>';
                }
                tmp += '</tr>';
                $('#table-' + idx + ' tbody').append( tmp );
            }
        }

        if ( ( idx > 0 ) && ( q == idx ) )
            genChart( param, idx, data );
    }

    function resetData()
    {
        $('#table-0 tbody').empty();
        console.log(  'advancedQuery.php?param=' + gCache.param + '&sd=' + gCache.sd + '&sh=' + gCache.sh + '&ed=' + gCache.ed + '&eh=' + gCache.eh + '&q=0' + '&pi=' + gCache.pi + '&pp=' + gCache.pp );
        $.ajax({
            url: 'advancedQuery.php?param=' + gCache.param + '&sd=' + gCache.sd + '&sh=' + gCache.sh + '&ed=' + gCache.ed + '&eh=' + gCache.eh + '&q=0' + '&pi=' + gCache.pi + '&pp=' + gCache.pp,
            dataType: 'json',
            success: function(data) {
                gData[ 0 ] = data;
                // draw frame here
                if ( data.queryResults.length > 0 ) {
                    for (var i=0, len=data.queryResults.length; i<len; i++)
                    {
                        var tmp = '<tr class="' + ((i%2==0)? 'odd' : 'even') + '">';
                        for ( var x in gObj[ gCache.param ][ 'table' ][ lang ][ 0 ] )
                        {
                            tmp += '<td>';
                            switch( x )
                            {
                            case 'id':
                                tmp += (((gCache.pi - 1) * gCache.pp) + ( i + 1 ));
                                break;
                            case 'protocol':
                                data.queryResults[ i ][ x ] = gProto[ data.queryResults[ i ][ x ] ];
                                tmp += data.queryResults[ i ][ x ];
                                break;
                            case 'txBytes':
                            case 'rxBytes':
                            case 'totalBytes':
                                var mkbs = parseInt( data.queryResults[ i ][ x ] );
                                tmp += ( ( mkbs > 1000000000 )? (mkbs/1000000000).toFixed(2) + ' GB' : ( ( mkbs > 1000000 )? (mkbs/1000000).toFixed(2) + ' MB' : ( ( 0 == mkbs )? 0 : (mkbs/1000).toFixed(2) + ' KB' ) ) );
                                break;
                            default:
                                tmp += data.queryResults[ i ][ x ];
                            }
                            tmp += '</td>';
                        }
                        tmp += '</tr>';
                        $('#table-0 tbody').append( tmp );
                    }
                    $('#rowsPage').html( gCache.pi );
                    $('#rowsPages').html( Math.ceil( data.queryRows/gCache.pp ) );
                } else {
                    $('#rowsPage').html(0);
                    $('#rowsPages').html(0);
                }
            }
        });
    }

    function genChart( param, idx, data )
    {
        if (gChart[ idx ])
            gChart[ idx ].destroy();

        if ( 0 === parseInt( data.length ) )
            $('#chart-' + idx).html( '<div class="noData"><b>No Data</b></div>' );
        else {
            if ($('.noData').exists())
                $('#chart-' + idx).empty();

             if ('pie' == gObj[ param ].chart[ lang ][ idx ].type) {
                 $('#chart-' + idx).html('<canvas id="pie-' + idx + '" width="480" height="480" style="width:480px; height:480px;"></canvas>');
                 var pieData = [];
                 for (var i=0, len=data.length; i<len; i++)
                 {
                      pieData.push( {value: parseInt(data[ i ].totalBytes), color: gColor[ i ], highlight: gColor[ i ], label: data[ i ].protocol} );
                 }

                 gChart[ idx ] = new Chart( $('#pie-' + idx).get(0).getContext('2d') ).Pie( pieData, { animateRotate: false});

             } else {
                gChart[ idx ] = new gY.Chart({
                    dataProvider: data,
                    categoryKey: gObj[ param ].chart[ lang ][ idx ].catKey,
                    type: gObj[ param ].chart[ lang ][ idx ].type,
                    styles: gObj[ param ].chart[ lang ][ idx ].styleDef,
                    horizontalGridlines: true
                }).render( '#chart-' + idx );
            }
        }
    }

    function genWeekly() {

    }

    function genHd( content ) {
        $('#bd_hd').html( '<p>' + content + '</p>' );
    }

    function genBd( param, sd, sh, ed, eh, q ) {
        $('#bd_bd').append('<div id="bd_bd_' + param + '" class="tabber"><ul></ul></div>');

        for ( var x in gObj[ param ][ 'tabs' ][ lang ] )
        {
            $('.tabber ul').append('<li id="tab-' + x + '"><a href="#panel-' + x + '">' + gObj[ param ][ 'tabs' ][ lang ][ x ] + '</a></li>');
            $('.tabber').append('<div id="panel-' + x + '"></div>');
            // data ready falg
            gQue[ x ] = true;
            gTabs.push( x );
        }

        $('.tabber').tabs({
            active: q,
            create: function( event, ui ) {
                if ( 0 == q ) {
                    $('.pdfer').hide();
                    $('.pager').show();
                } else {
                    $('.pdfer').show();
                    $('.pager').hide();
                }
            },
            activate: function( event, ui ) {
                gCache.tabIndex = parseInt( ui.newTab.index() );
                if ( 0 === parseInt( ui.newTab.index() ) ) {
                    $('.pdfer').hide();
                    $('.pager').show();
                } else {
                    $('.pdfer').show();
                    $('.pager').hide();
                    setData( param, gCache.tabIndex, gCache.tabIndex, gData[ gCache.tabIndex ].queryResults.slice( 0, $('#tops').val() ) );
                }
            },
            disabled: gTabs
        });

        // data
        loadingToggle( true );
        getData( param, sd, sh, ed, eh, q, q );
    }

    function genFt( param ) {
        var tmp = '<div id="pagerDiv">';
        tmp += '<table id="pagerTable-' + param + '" class="BorderNone">';
        tmp += '<tr>';
        tmp += '<td class="pager"><button Class="Move2First" id="Move2First"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><button Class="Move2Prev" id="Move2Prev"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager" style="width: 100px"><span id="rowsPage" class="rows">1</span><span class="rows"> / </span><span id="rowsPages" class="rows">1</span></td>';
        tmp += '<td class="pager"><button Class="Move2Next" id="Move2Next"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><button Class="Move2Last" id="Move2Last"><span class="ui-icon"></span></button></td>';
        tmp += '<td class="pager"><select id="rows"><option value="20">20 rows</option><option value="50">50 rows</option><option value="100">100 rows</option></select>';
        tmp += '<td class="pdfer"><select id="tops"><option value="10">Top 10</option><option value="25">Top 25</option><option value="50">Top 50</option></select>';

        tmp += '<td class="pdfer"><button Class="ExportPDF" id="ExportPDF"><span class="ui-icon"></span></button></td>';
        tmp += '</tr>';
        tmp += '</table>';
        tmp += '</div>';

        $('#bd_ft').html( tmp );
    }

    function genFooter() {
        $('#ft').html('<p>Copyright &copy; 2014 Titan ARC corp.</p>');
    }

    function loadingToggle( flag ) {
        if (flag) {
            $('body').addClass('loadingClass');
        } else {
            $('body').removeClass('loadingClass');
        }
    }

    function init() {
        if ( 'weekly' == $.getUrlVar( 'param' ) ) {
            genWeekly();
        } else {
            gCache.param = $.getUrlVar( 'param' );
            gCache.sd = $.getUrlVar( 'sd' );
            gCache.sh = $.getUrlVar( 'sh' );
            gCache.ed = $.getUrlVar( 'ed' );
            gCache.eh = $.getUrlVar( 'eh' );
            gCache.tabIndex = parseInt( $.getUrlVar( 'q' ) );
            gCache.pi = 1;
            gCache.pp = 20;

            genHd( gObj[ $.getUrlVar( 'param' ) ][ 'title' ][ lang ] );
            genFt( $.getUrlVar( 'param' ) );
            genBd( $.getUrlVar( 'param' ), $.getUrlVar( 'sd' ), $.getUrlVar( 'sh' ), $.getUrlVar( 'ed' ), $.getUrlVar( 'eh' ), $.getUrlVar( 'q' ) );
        }
        genFooter();
    }

    $.ajax({
        url: 'lang/' + lang + '-protocol.txt',
        dataType: 'json',
        success: function( data ) {
            for (var i=0,len=data.length; i<len; i++)
                gProto[ data[ i ].key ] = data[ i ].value;
        }
    }).done( init() );

});

    </script>
  </head>
  <body>

    <div id="layout">
      <div id="hd">
        <div id="hd_top"></div>
        <div id="hd_mark"><div id="hd_label">TitanWALL <span>&reg;</span></div></div>
      </div>
      <div id="bd">
        <div id="bd_hd"></div>
        <div id="bd_bd"></div>
        <div id="bd_ft"></div>
      </div>
      <div id="ft"></div>
      <div class="modals"></div>
    </div>

  </body>
</html>
